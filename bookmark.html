<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>KOMIK.YYDZ - Terakhir Baca & Bookmark</title>
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">
<style>
body {
  font-family: 'Poppins', sans-serif;
  background: linear-gradient(160deg, #1e3c72, #2a5298);
  color: #f0f0f0;
  padding: 20px;
  margin: 0;
}
h1 {
  text-align: center;
  margin-bottom: 30px;
  color: #fff;
  text-shadow: 2px 2px 10px rgba(0,0,0,0.5);
}
.section h2 {
  margin-bottom: 20px;
  color: #ffdd57;
  text-shadow: 1px 1px 5px rgba(0,0,0,0.4);
  display: flex;
  align-items: center;
  gap: 10px;
}
.read-first-btn {
  font-size:12px;
  padding:4px 8px;
  border-radius:12px;
  background: rgba(255,255,255,0.1);
  border:none;
  color:#ffdd57;
  cursor:pointer;
}
.scroll-container {
  display: flex;
  overflow-x: auto;
  gap: 20px;
  padding-bottom: 10px;
  scroll-behavior: smooth;
}
.scroll-container::-webkit-scrollbar { height: 8px; }
.scroll-container::-webkit-scrollbar-thumb { background: rgba(255,255,255,0.3); border-radius: 4px; }
.komik-card {
  background: rgba(255,255,255,0.05);
  border-radius: 20px;
  overflow: hidden;
  flex: 0 0 220px;
  display: flex;
  flex-direction: column;
  position: relative;
  cursor: pointer;
  transition: transform 0.3s, box-shadow 0.3s;
}
.komik-card:hover { transform: translateY(-5px) scale(1.03); box-shadow: 0 10px 25px rgba(0,0,0,0.4); }
.komik-card img { width:100%; height:280px; object-fit:cover; transition: transform 0.3s; }
.komik-card img:hover { transform: scale(1.05); }
.komik-card .info { padding:10px; display:flex; flex-direction:column; }
.komik-card .info h2 { font-size:16px; color:#fff; margin-bottom:5px; line-height:1.2; text-shadow:1px 1px 3px rgba(0,0,0,0.4);}
.komik-card .info button {
  display:flex; align-items:center; justify-content:center; padding:6px 10px;
  border-radius:20px; font-weight:500; background:linear-gradient(135deg, #ff416c, #ff4b2b);
  color:#fff; border:none; cursor:pointer; font-size:12px; gap:5px; margin-top:5px;
}
.remove-btn {
  position:absolute; bottom:8px; right:8px; font-size:14px;
  background:rgba(255,255,255,0.15); color:#ff416c; padding:4px 8px; border-radius:12px;
}
.remove-btn:hover { background:#ff416c; color:#fff; }
.bookmark-btn {
  position:absolute; top:8px; right:8px; font-size:18px;
  width:34px; height:34px; border-radius:50%; border:none;
  background:rgba(255,255,255,0.15); color:#fff;
}
.bookmark-btn.saved { color:gold; }
.empty { text-align:center; color:#ffdd57; font-size:14px; margin-top:10px; }
footer { text-align:center; margin-top:30px; color:#fff; font-size:14px; }
footer a { color:#ffdd57; text-decoration:none; }
footer a:hover { text-decoration:underline; }

.bottom-menu {
  position: fixed;
  bottom: 0;
  left: 0;
  width: 100%;
  background: rgba(30, 60, 114, 0.95);
  display: flex;
  justify-content: space-around;
  padding: 10px 0;
  border-top: 1px solid rgba(255,255,255,0.1);
  backdrop-filter: blur(10px);
  z-index: 1000;
  box-shadow: 0 -5px 15px rgba(0,0,0,0.3);
  border-radius: 15px 15px 0 0;
}

.bottom-menu a {
  text-decoration: none;
  color: #fff;
  font-size: 14px;
  display: flex;
  flex-direction: column;
  align-items: center;
  transition: all 0.3s ease;
}

.bottom-menu a i {
  font-size: 20px;
  margin-bottom: 3px;
}

.bottom-menu a:hover {
  color: #ff416c;
  transform: scale(1.1);
}

@media(max-width:768px){
  .komik-card { flex:0 0 180px; }
  .komik-card img { height:200px; }
  .komik-card .info h2 { font-size:14px; }
}
</style>
</head>
<body>

<h1>
  <img src="https://raw.githubusercontent.com/Yudzxml/UploaderV2/main/tmp/e8193fb7.png" alt="Logo KOMIK.YYDZ" style="display:block;margin:0 auto;width:180px;height:auto;">
  KOMIK.YYDZ
</h1>

<div class="section">
  <h2>‚≠ê Bookmark</h2>
  <div id="bookmarkContainer" class="scroll-container"></div>
  <p id="bookmarkEmpty" class="empty">Belum ada komik di bookmark.</p>
</div>

<div class="section">
  <h2>üìñ Terakhir Baca
    <button id="clearLastRead" class="read-first-btn">Hapus Semua</button>
    <button id="readFirstBtn" class="read-first-btn">Buka Terakhir Baca</button>
  </h2>
  <div id="lastReadContainer" class="scroll-container"></div>
  <p id="lastReadEmpty" class="empty">Belum ada komik yang dibaca.</p>
</div>

<footer>
  <p>¬© 2025 <strong>KOMIK.YYDZ</strong>. Semua hak cipta dilindungi.</p>
  <p>
    <a href="https://wa.me/6283872031397" target="_blank"><i class="fab fa-whatsapp"></i></a>
    <a href="https://t.me/Yudzxzy" target="_blank"><i class="fab fa-telegram-plane"></i></a>
    <a href="mailto:yudaaryaardhana1122@email.com" target="_blank"><i class="fas fa-envelope"></i></a>
  </p>
  <p>Desain & Pengembangan oleh <a href="#" target="_blank">Yudzxml</a></p>
</footer>

<!-- Bottom Menu -->
<nav class="bottom-menu">
  <a href="index.html" title="Beranda"><i class="fas fa-home"></i><span>Beranda</span></a>
  <a href="bookmark.html" title="Bookmark"><i class="fas fa-bookmark"></i><span>Bookmark</span></a>
  <a href="akun.html" title="Akun"><i class="fas fa-user"></i><span>Akun</span></a>
  <a href="search.html" title="Cari"><i class="fas fa-search"></i><span>Cari</span></a>
</nav>

<script>
function renderKomik(container, data, emptyMsgId){
  container.innerHTML = '';
  if(!data || data.length===0){
    document.getElementById(emptyMsgId).style.display='block';
    return;
  }
  document.getElementById(emptyMsgId).style.display='none';
  data.sort((a,b)=>(b.lastRead||0)-(a.lastRead||0));

  data.forEach(item=>{
    const card = document.createElement('div');
    card.className='komik-card';
    const bookmarks = JSON.parse(localStorage.getItem('komikBookmarks'))||[];
    const isSaved = bookmarks.some(k=>k.url===item.url);

    card.innerHTML=`
      <img src="${item.thumb||'https://via.placeholder.com/280x280?text=No+Image'}" alt="${item.title}">
      <button class="bookmark-btn ${isSaved?'saved':''}" title="Bookmark">‚òÖ</button>
      <div class="info">
        <h2>${item.title}</h2>
        <div class="last-read">${item.lastRead?'Terakhir dibaca: '+formatDate(item.lastRead):''}</div>
        <button class="remove-btn" data-url="${item.url}"><i class="fas fa-trash"></i></button>
      </div>
    `;
    container.appendChild(card);

    // Klik card
    card.addEventListener('click', e=>{
      if(!e.target.closest('button')){
        if(container.id==='lastReadContainer'){
          window.location.href=`chapter.html?url=${encodeURIComponent(item.url)}`;
          addLastRead(item.title, item.url, item.thumb);
        } else {
          window.location.href=`detail.html?url=${encodeURIComponent(item.url)}`;
        }
      }
    });

    // Bookmark toggle
    const btn = card.querySelector('.bookmark-btn');
    btn.addEventListener('click', e=>{
      e.stopPropagation();
      let bookmarks = JSON.parse(localStorage.getItem('komikBookmarks'))||[];
      if(bookmarks.some(k=>k.url===item.url)){
        bookmarks = bookmarks.filter(k=>k.url!==item.url);
        btn.classList.remove('saved');
      } else {
        bookmarks.push({title:item.title,thumb:item.thumb,url:item.url,date:Date.now()});
        btn.classList.add('saved');
      }
      localStorage.setItem('komikBookmarks', JSON.stringify(bookmarks));
      renderKomik(document.getElementById('bookmarkContainer'), bookmarks, 'bookmarkEmpty');
    });

    // Remove
    card.querySelector('.remove-btn').addEventListener('click', e=>{
      e.stopPropagation();
      const idx = data.findIndex(k=>k.url===item.url);
      if(idx>-1){
        data.splice(idx,1);
        localStorage.setItem(container.id==='bookmarkContainer'?'komikBookmarks':'komikLastRead', JSON.stringify(data));
        renderKomik(container, data, emptyMsgId);
      }
    });
  });
}

function formatDate(ts){
  const d=new Date(ts);
  return `${d.getDate().toString().padStart(2,'0')}/${(d.getMonth()+1).toString().padStart(2,'0')}/${d.getFullYear()} ${d.getHours().toString().padStart(2,'0')}:${d.getMinutes().toString().padStart(2,'0')}`;
}

function addLastRead(title, url, thumb){
  const now = Date.now();
  let existing = JSON.parse(localStorage.getItem('komikLastRead')) || [];

  // Cek apakah komik sudah ada
  const idx = existing.findIndex(k => k.title === title);

  if(idx > -1){
    // Update timestamp dan data lainnya jika sudah ada
    existing[idx] = { ...existing[idx], url, thumb, lastRead: now };
  } else {
    // Tambah komik baru di awal array
    existing.unshift({ title, url, thumb, lastRead: now });
  }

  // Batasi maksimal 20 komik terakhir
  if(existing.length > 20) existing = existing.slice(0, 20);

  localStorage.setItem('komikLastRead', JSON.stringify(existing));
  renderKomik(document.getElementById('lastReadContainer'), existing, 'lastReadEmpty');
}

const bookmarks = JSON.parse(localStorage.getItem('komikBookmarks'))||[];
const lastRead = JSON.parse(localStorage.getItem('komikLastRead'))||[];
renderKomik(document.getElementById('bookmarkContainer'),bookmarks,'bookmarkEmpty');
renderKomik(document.getElementById('lastReadContainer'),lastRead,'lastReadEmpty');

// Hapus semua Last Read
document.getElementById('clearLastRead').addEventListener('click', ()=>{
  if(confirm('Yakin ingin menghapus semua data terakhir baca?')){
    localStorage.removeItem('komikLastRead');
    renderKomik(document.getElementById('lastReadContainer'),[], 'lastReadEmpty');
  }
});

// Buka terakhir baca pertama
document.getElementById('readFirstBtn').addEventListener('click', ()=>{
  const lastRead = JSON.parse(localStorage.getItem('komikLastRead'))||[];
  if(lastRead.length>0){
    const item = lastRead[0];
    window.location.href=`chapter.html?url=${encodeURIComponent(item.url)}`;
    addLastRead(item.title,item.url,item.thumb);
  } else alert('Belum ada komik yang dibaca.');
});
</script>
</body>
</html>